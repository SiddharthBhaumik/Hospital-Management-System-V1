{% extends "Admin/base.html" %}
{% block title %}Admin Dashboard{% endblock %}

{% block content %}

<div class="container mt-4">

    <h2 class="mb-4">Admin Dashboard Analytics</h2>

    <div class="row g-4">

        <div class="col-md-4">
            <div class="card shadow-sm border-0">
                <div class="card-body text-center">
                    <h4 class="text-primary">{{ total_departments }}</h4>
                    <p class="mb-0">Total Departments</p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card shadow-sm border-0">
                <div class="card-body text-center">
                    <h4 class="text-success">{{ active_doctors }}</h4>
                    <p class="mb-0">Active Doctors</p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card shadow-sm border-0">
                <div class="card-body text-center">
                    <h4 class="text-warning">{{ active_patients }}</h4>
                    <p class="mb-0">Active Patients</p>
                </div>
            </div>
        </div>

    </div>

    <div class="row mt-5 g-4">

        <div class="col-md-6">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h5 class="card-title text-center">Doctors Distribution per Department</h5>
                    <canvas id="doctorsPie"></canvas>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h5 class="card-title text-center">Completed Appointments per Department</h5>
                    <canvas id="completedPie"></canvas>
                </div>
            </div>
        </div>

    </div>

    <div class="row mt-5 g-4">

        <div class="col-md-6">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h5 class="card-title text-center">Completed Appointments - Last 7 Days</h5>
                    <canvas id="completed7days"></canvas>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h5 class="card-title text-center">Upcoming Appointments - Next 7 Days</h5>
                    <canvas id="upcoming7days"></canvas>
                </div>
            </div>
        </div>

    </div>

</div>

<script id="chart-data" type="application/json">{{ chart_data | tojson }}</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const chartData = JSON.parse(document.getElementById("chart-data").textContent);

    new Chart(document.getElementById("doctorsPie"), {
        type: "pie",
        data: {
            labels: chartData.deptLabels,
            datasets: [{
                data: chartData.doctorsPerDept,
                backgroundColor: [
                    '#FF6384',
                    '#36A2EB',
                    '#FFCE56',
                    '#4BC0C0',
                    '#9966FF',
                    '#FF9F40'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });

    new Chart(document.getElementById("completedPie"), {
        type: "pie",
        data: {
            labels: chartData.deptLabels,
            datasets: [{
                data: chartData.completedPerDept,
                backgroundColor: [
                    '#FF6384',
                    '#36A2EB',
                    '#FFCE56',
                    '#4BC0C0',
                    '#9966FF',
                    '#FF9F40'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });

    new Chart(document.getElementById("completed7days"), {
        type: "line",
        data: {
            labels: chartData.last7Labels,
            datasets: [{
                label: "Completed",
                data: chartData.last7Completed,
                borderColor: '#28a745',
                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    }
                }
            },
            plugins: {
                legend: {
                    display: true,
                    position: 'top'
                }
            }
        }
    });


    new Chart(document.getElementById("upcoming7days"), {
        type: "line",
        data: {
            labels: chartData.next7Labels,
            datasets: [{
                label: "Upcoming",
                data: chartData.next7Upcoming,
                borderColor: '#ffc107',
                backgroundColor: 'rgba(255, 193, 7, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    }
                }
            },
            plugins: {
                legend: {
                    display: true,
                    position: 'top'
                }
            }
        }
    });
});
</script>

{% endblock %}