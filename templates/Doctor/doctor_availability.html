{% extends "Doctor/base.html" %}
{% block title %}Set Availability{% endblock %}

{% block content %}

<h2 class="mb-4">Set Your Availability for the Next 7 Days</h2>

<form method="POST">

    {% for day, slots in slots_by_date.items() %}
    <div class="card mb-4">

        <div class="card-header bg-primary text-white">
            <strong>{{ day.strftime("%A, %B %d") }}</strong>
        </div>

        <div class="card-body">
            <div class="row">

                {% for slot in slots %}
                {% set availability = doctor_availability_map.get((day, slot.slot_id)) %}
                {% set is_past = past_map[(day, slot.slot_id)] %}
                {% set is_booked = availability.booked if availability else False %}
                {% set is_selected = availability is not none %}

                {% set start_time = slot.slot_start %}
                {% set end_hour = (start_time.hour + 1) % 24 %}
                {% set end_time = start_time.replace(hour=end_hour) %}

                <div class="col-md-3 col-sm-4 col-6 mb-3">
                    <div class="form-check">

                        <input class="form-check-input"
                               type="checkbox"
                               id="slot_{{ day }}_{{ slot.slot_id }}"
                               name="selected_slots"
                               value="{{ day }}|{{ slot.slot_id }}"
                               {% if is_selected %}checked{% endif %}
                               {% if is_booked or is_past %}disabled{% endif %}
                        >

                        <label class="form-check-label" for="slot_{{ day }}_{{ slot.slot_id }}">
                            {{ start_time.strftime("%I:%M %p") }}-{{ end_time.strftime("%I:%M %p") }}

                            {% if is_booked %}
                                <span class="text-danger">ğŸ”’</span>
                            {% elif is_past %}
                                <span class="text-secondary">â°</span>
                            {% endif %}
                        </label>
                    </div>
                </div>

                {% endfor %}
            </div>
        </div>

    </div>
    {% endfor %}

    <div class="text-end">
        <button type="submit" class="btn btn-success">
            Save Availability
        </button>
    </div>

</form>

{% endblock %}
