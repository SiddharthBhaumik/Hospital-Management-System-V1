{% extends "doctor_base.html" %}
{% block title %}Set Availability{% endblock %}

{% block content %}

<h2 class="mb-4">Set Your Availability for the Next 7 Days</h2>

<form method="POST" action="{{ url_for('doctor.doctor_availability') }}">

    {% for date, slots in slots_by_date.items() %}
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-primary text-white">
            <strong>{{ date }}</strong>
        </div>

        <div class="card-body">

            <div class="row">
                {% for slot in slots %}
                {% set availability = doctor_availability_map.get(slot.slot_id) %}
                {% set is_booked = availability.booked if availability else False %}
                {% set is_selected = availability is not none %}

                <div class="col-md-3 col-sm-4 col-6 mb-2">
                    <div class="form-check">

                        <input class="form-check-input"
                               type="checkbox"
                               id="slot_{{ slot.slot_id }}"
                               name="selected_slots"
                               value="{{ slot.slot_id }}"

                               {% if is_selected %}
                                   checked
                               {% endif %}

                               {% if is_booked %}
                                   disabled
                               {% endif %}
                        >

                        <label class="form-check-label" for="slot_{{ slot.slot_id }}">
                            {{ slot.slot_start.strftime("%I:%M %p") }}

                            {% if is_booked %}
                                <span class="text-danger ms-1" title="This slot already has appointments">
                                    ðŸ”’
                                </span>
                            {% endif %}
                        </label>
                    </div>
                </div>

                {% endfor %}
            </div>

        </div>
    </div>
    {% endfor %}

    <div class="text-end mt-3">
        <button type="submit" class="btn btn-success btn-lg">
            Save Availability
        </button>
    </div>

</form>

{% endblock %}
